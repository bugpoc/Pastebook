@using PastebookEntityLibrary
@using PastebookDataAccessLibrary
@{ 
    var sessionUsername = Session["username"].ToString();
    USER user = new USER();
    UserDataAccess userDataAccess = new UserDataAccess();
    user = userDataAccess.GetUser(null, sessionUsername);
    var queryStringUsername = Request.QueryString["username"];
    string imgSrc = null;
    if (user.PROFILE_PIC !=null)
    {
        var base64 = Convert.ToBase64String(user.PROFILE_PIC);
        imgSrc = String.Format("data:image/gif;base64,{0}", base64);
    }
    else
    {
        imgSrc = "/Content/Images/default.jpg";
    }
}
<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Pastebook</title>
    @Styles.Render("~/Content/gentelella")
</head>
<body class="nav-md">
    <div class="container body">
        <div class="main_container">
            <div class="col-md-3 left_col">
                <div class="left_col scroll-view">
                    <div class="navbar nav_title" style="border: 0;">
                        <a href="Index" class="site_title"><i class="fa fa-connectdevelop"></i> <span class="highlight">Paste</span>book</a>
                    </div>
                    <div class="clearfix"></div>
                    <!-- menu profile quick info -->
                    <div class="profile">
                        <div class="profile_pic">
                            <img src="@imgSrc" alt="Profile Picture" class="img-circle profile_img">
                        </div>
                        <div class="profile_info">
                            <span>Welcome,</span>
                            <h2>@user.FIRST_NAME @user.LAST_NAME</h2>
                        </div>
                    </div>
                    <!-- /menu profile quick info -->
                    <br />
                    <!-- sidebar menu -->
                    <div id="sidebar-menu" class="main_menu_side hidden-print main_menu">
                        <div class="menu_section">
                            <h3>Menu</h3>
                            <ul class="nav side-menu">
                                <li>
                                    <a href="\Pastebook\Index"><i class="fa fa-home"></i> Home </a>
                                </li>
                                <li>
                                    <a><i class="fa fa-user"></i> Profile </a>
                                </li>
                                <li>
                                    <a href="\Pastebook\Friends"><i class="fa fa-users"></i> Friends </a>
                                </li>
                                <li>
                                    <a><i class="fa fa-gear"></i> Settings <span class="fa fa-chevron-down"></span></a>
                                    <ul class="nav child_menu">
                                        <li>
                                            <a href="\Pastebook\EditInformation">Edit Information</a>
                                        </li>
                                        <li>
                                            <a href="\Pastebook\EditEmail">Edit Email Address</a>
                                        </li>
                                        <li>
                                            <a href="\Pastebook\EditPassword">Edit Password</a>
                                        </li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                        
                    </div>
                    <!-- /sidebar menu -->
                </div>
            </div>
            <!-- top navigation -->
            <div class="top_nav">
                <div class="nav_menu">
                    <nav>
                        <div class="nav toggle">
                            <a id="menu_toggle"><i class="fa fa-bars"></i></a>
                        </div>
                        <div class="col-md-3">
                            <div class="input-group search-div">
                                <input id="txtName" type="text" class="form-control search-bar" placeholder="Search for...">
                                <span class="input-group-btn">
                                    <button id="searchUser" class="btn btn-default search-button" type="button">Go!</button>
                                </span>
                            </div>
                        </div>
                        <ul class="nav navbar-nav navbar-right">
                            <li class="">
                                <a href="javascript:;" class="user-profile dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                                    <img src="@imgSrc" alt="Profile Picture">@user.FIRST_NAME @user.LAST_NAME
                                    <span class="fa fa-angle-down"></span>
                                </a>
                                <ul class="dropdown-menu dropdown-usermenu pull-right">
                                    <li><a href="javascript:;"> Profile</a></li>
                                    <li>
                                        <a href="javascript:;">
                                            <span class="badge bg-red pull-right">50%</span>
                                            <span>Settings</span>
                                        </a>
                                    </li>
                                    <li><a href="javascript:;">Help</a></li>
                                    <li><a href="login.html"><i class="fa fa-sign-out pull-right"></i> Log Out</a></li>
                                </ul>
                            </li>
                            <li role="presentation" class="dropdown">
                                <a id="viewNotifications" href="javascript:;" class="dropdown-toggle info-number" data-toggle="dropdown" aria-expanded="false">
                                    <i class="fa fa-globe"></i>
                                    <span id="notifCount" class="badge bg-green"></span>
                                </a>
                                <ul id="menu1" class="dropdown-menu list-unstyled msg_list" role="menu">
                                    @{ Html.RenderAction("NotificationPartial", "Pastebook");}
                                </ul>
</li>
                        </ul>
                    </nav>
                </div>
            </div>
            <!-- /top navigation -->
            <!-- page content -->
            <div class="right_col" role="main">
                @RenderBody()
            </div>
            <!-- /page content -->
            <!-- footer content -->
            <footer>
                <div class="pull-right">
                    Gentelella - Bootstrap Admin Template by <a href="https://colorlib.com">Colorlib</a>
                </div>
                <div class="clearfix"></div>
            </footer>
            <!-- /footer content -->
        </div>
    </div>
    @Scripts.Render("~/bundles/jquery")
    @Scripts.Render("~/bundles/bootstrap")
    <script src="~/Scripts/custom.js"></script>
    @RenderSection("scripts", required: false)
    <script>
        $(document).ready(function () {

            window.onload = reloadBadge;

            setInterval(reloadBadge, 60000);

            function reloadBadge() {
                $.ajax({
                    url: '/Pastebook/GetCountOfNotification',
                    type: 'GET',
                    success: function (data) {
                        ChangeBadgeCount(data);
                    },
                    error: function () {
                        alert('Badge went wrong')
                    }
                });
            }

            function ChangeBadgeCount(data) {
                $('#notifCount').text(data.Count);
            }

            $('#viewNotifications').click(function () {
                $.ajax({
                    url: '/Pastebook/GetCountOfNotification',
                    type: 'GET',
                    success: function (data) {
                        LoadNotificationContent(data);
                    },
                    error: function () {
                        alert('Notification went wrong')
                    }
                });
            });

            function LoadNotificationContent(data)
            {
                if(data.Count>0)
                {
                    $('#menu1').load('/Pastebook/NotificationPartial');
                }
            }

            $('#searchUser').click(function () {
                $(location).attr('href', '/Pastebook/SearchUser?name=' + $('#txtName').val());
            });
        });
    </script>
</body>
</html>
